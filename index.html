<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Keiketsu Mini v8.8a（WHO原文×編集版 二層管理）</title>
<!-- 省略: スタイルは v8.8 と同じ -->
</head>
<body>
  <header>
    <h1>Keiketsu Mini v8.8a</h1>
    <nav>
      <button id="tabStudy" class="active" onclick="switchView('viewStudy','tabStudy')">学習</button>
      <button id="tabManage" onclick="switchView('viewManage','tabManage')">データ管理</button>
      <button id="tabAbout" onclick="switchView('viewAbout','tabAbout')">説明</button>
    </nav>
  </header>

  <!-- 省略: 本文は v8.8 と同じ（UI構造・id は同一） -->

  <script>
  // ===== ユーティリティ =====
  function el(id){ return document.getElementById(id); }
  (function(){
    // タブ切替：グローバル明示
    function switchView(viewId, tabId){
      ['viewStudy','viewManage','viewAbout'].forEach(function(id){
        var sec = el(id); if(sec) sec.classList.add('hidden');
      });
      var v=el(viewId); if(v) v.classList.remove('hidden');
      ['tabStudy','tabManage','tabAbout'].forEach(function(id){
        var b = el(id); if(b) b.classList.remove('active');
      });
      var t=el(tabId); if(t) t.classList.add('active');
    }
    window.switchView = switchView; // ← グローバル公開
  })();
  </script>

  <script>
  // ====== ここからアプリ本体（v8.8 をベースに、関数をすべて window に公開） ======
  var STORAGE='keiketsu-mini-v88a';
  function toast(msg){ var t=el('toast'); t.textContent=msg; t.classList.add('show');
    clearTimeout(window._toastT); window._toastT=setTimeout(function(){t.classList.remove('show')},1500); }

  // …（中略：v8.8 と同じロジック：二層位置・並び順・四択・再出題・有効/無効など）

  // --- 重要：inline onclick から呼ばれる関数はすべて window.* で公開 ---
  window.start = start;
  window.endSession = endSession;
  window.flip = flip;
  window.markResult = markResult;
  window.flashClick = flashClick;
  window.onImportClick = onImportClick;
  window.onAddClick = onAddClick;
  window.onBulkPasteOpen = onBulkPasteOpen;
  window.onPasteCancel = onPasteCancel;
  window.onPasteApply = onPasteApply;
  window.onDeleteSelected = onDeleteSelected;
  window.onExportCSV = onExportCSV;
  window.onExportJSON = onExportJSON;
  window.onCheckAll = onCheckAll;
  window.rowDup = rowDup;
  window.rowDel = rowDel;

  // 初期化
  (async function(){ await importSeed(); refresh(); })();
  </script>

  <!-- シード（少量のサンプル。運用時は全データをJSONで） -->
  <script type="application/json" id="seedData">
  [
    {"code":"CV12","name":"中脘","meridian":"任脈","reading":"ちゅうかん","location_who":"臍の上4寸、前正中線上","location_edit":"","indications":"胃痛、消化不良、嘔吐、食欲不振","memo":"","shu":"","phase":"","edited":0,"enabled":1},
    {"code":"GV14","name":"大椎","meridian":"督脈","reading":"だいつい","location_who":"第7頚椎棘突起下、後正中線上","location_edit":"","indications":"風邪、発熱、頚肩の痛み","memo":"","shu":"","phase":"","edited":0,"enabled":1},
    {"code":"LU1","name":"中府","meridian":"手の太陰肺経","reading":"ちゅうふ","location_who":"第1肋間、前正中線の外方6寸","location_edit":"","indications":"咳、喘息、胸痛","memo":"","shu":"","phase":"","edited":0,"enabled":1},
    {"code":"LI11","name":"曲池","meridian":"手の陽明大腸経","reading":"きょくち","location_who":"肘を屈曲してできる横紋の外側端","location_edit":"","indications":"発熱、皮膚疾患、高血圧","memo":"","shu":"","phase":"","edited":0,"enabled":1}
  ]
  </script>

  <div id="toast" role="status" aria-live="polite"></div>
</body>
</html>
